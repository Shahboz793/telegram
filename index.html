<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Media Only Viewer (Telegram)</title>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0b0b0b; color:#fff; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 18px; margin: 8px 0 12px; }
    .hint { opacity:.78; font-size: 13px; line-height: 1.5; margin-bottom: 16px; }
    .card { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.10); border-radius: 14px; padding: 14px; }
    .row { display:flex; gap:10px; align-items:center; }
    input[type="url"]{
      width:100%; padding: 12px 12px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.35); color:#fff;
      outline: none;
    }
    button{
      padding: 12px 14px; border-radius: 12px; border: 0;
      background: linear-gradient(135deg,#ff3b3b,#ff7a18);
      color:#fff; font-weight: 700; cursor:pointer;
      white-space: nowrap;
    }
    button:active{ transform: scale(.98); }
    .links { margin-top: 12px; display:grid; gap:10px; }
    a.media-link{
      display:block; text-decoration:none; color:#fff;
      padding: 12px; border-radius: 12px;
      background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.10);
    }
    a.media-link small{ display:block; opacity:.7; margin-top:6px; }

    /* Media-only overlay */
    body.media-only .wrap { display:none !important; }

    #overlay{
      position: fixed; inset:0; background:#000; z-index: 99999;
      display:none; align-items:center; justify-content:center; text-align:center;
      padding: 24px;
    }
    body.media-only #overlay{ display:flex; }
    #overlay .box{
      max-width: 520px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 18px;
    }
    #overlay .title{ font-weight: 800; margin-bottom: 6px; }
    #overlay .sub{ opacity:.8; font-size: 13px; line-height: 1.5; }
    #overlay .actions{ margin-top: 12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
    #overlay .ghost{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      font-weight: 700;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Telegram “faqat video/post” ko‘rish</h1>
    <div class="hint">
      Bu sahifa Telegram WebApp ichida ishlashi uchun botdan WebApp qilib oching.
      Link bosilganda Telegram ichida post “single” rejimda ochiladi va sahifadagi boshqa narsalar ko‘rinmaydi.
    </div>

    <div class="card">
      <div class="row">
        <input id="urlInput" type="url" placeholder="https://t.me/c/3086001686/2/17260" />
        <button id="openBtn" type="button">Ochish</button>
      </div>

      <div class="links">
        <!-- Namuna. O‘zingizning linklaringizga almashtiring -->
        <a class="media-link" href="https://t.me/c/3086001686/2/17260" data-type="tgmsg">
          1) Video post (t.me/c/...)
          <small>Click → Telegram ichida “single” ko‘rinishda ochadi</small>
        </a>

        <!-- Xohlasangiz PDF yoki boshqa t.me link ham qo‘shishingiz mumkin -->
        <!-- <a class="media-link" href="https://t.me/c/XXXXXXXXXX/YYYY/ZZZZZ" data-type="tgmsg">2) PDF post</a> -->
      </div>
    </div>
  </div>

  <!-- Fullscreen overlay -->
  <div id="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="box">
      <div class="title">Ochilyapti…</div>
      <div class="sub">
        Video/post Telegram ichida ochiladi. Agar ochilmasa, “Qayta urinish”ni bosing yoki linkni tekshiring.
      </div>
      <div class="actions">
        <button id="retryBtn" type="button">Qayta urinish</button>
        <button id="backBtn" class="ghost" type="button">Orqaga (sahifaga)</button>
      </div>
    </div>
  </div>

  <script>
    // Telegram WebApp init
    const tg = window.Telegram?.WebApp;
    try {
      tg?.ready?.();
      tg?.expand?.();
      tg?.disableVerticalSwipes?.();
    } catch (e) {}

    // (Ixtiyoriy) faqat bitta Telegram akkauntiga ruxsat berish:
    // ALLOWED_TG_ID ni o'zingizning Telegram user id'ingizga qo'ying.
    // Eslatma: bu client-side tekshiruv, kuchli himoya emas.
    const ALLOWED_TG_ID = null; // masalan: 123456789

    const overlay = document.getElementById('overlay');
    const urlInput = document.getElementById('urlInput');
    const openBtn = document.getElementById('openBtn');
    const retryBtn = document.getElementById('retryBtn');
    const backBtn  = document.getElementById('backBtn');

    let lastUrl = "";

    function isAllowedUser() {
      if (!ALLOWED_TG_ID) return true;
      const uid = tg?.initDataUnsafe?.user?.id;
      return Number(uid) === Number(ALLOWED_TG_ID);
    }

    // t.me/c/... linklar uchun ?single qo‘shib beramiz
    function withSingleParam(url) {
      try {
        const u = new URL(url);
        const host = u.hostname.replace(/^www\./, '');
        if (host !== 't.me' && host !== 'telegram.me') return url;

        // allaqachon "single" bo‘lsa tegmaymiz
        if (!u.searchParams.has('single')) u.searchParams.set('single', '1');
        return u.toString();
      } catch (e) {
        // URL bo'lmasa qaytaramiz
        return url;
      }
    }

    function setMediaOnly(on) {
      document.body.classList.toggle('media-only', !!on);
      overlay.setAttribute('aria-hidden', on ? 'false' : 'true');
      if (on) {
        // Telegram BackButton
        if (tg?.BackButton) {
          tg.BackButton.show();
          tg.BackButton.onClick(closeOverlay);
        }
        history.pushState({ mediaOnly: true }, "");
      } else {
        if (tg?.BackButton) tg.BackButton.hide();
      }
    }

    function openTelegramInternal(url) {
      // Telegram ichida t.me linkni ochish
      const finalUrl = withSingleParam(url);
      lastUrl = finalUrl;

      if (!isAllowedUser()) {
        alert("Kirish taqiqlangan (akkaunt mos emas).");
        return;
      }

      setMediaOnly(true);

      // Telegram API bo‘lsa shundan foydalanamiz
      try {
        if (tg?.openTelegramLink) {
          tg.openTelegramLink(finalUrl);
          return;
        }
        // Ba’zi versiyalarda openLink ishlashi mumkin
        if (tg?.openLink) {
          tg.openLink(finalUrl, { try_instant_view: false });
          return;
        }
      } catch (e) {}

      // Fallback: oddiy brauzerda o‘tish
      window.location.href = finalUrl;
    }

    function closeOverlay() {
      setMediaOnly(false);
      // overlay yopilganda inputga qaytamiz
      try { urlInput?.focus(); } catch (e) {}
    }

    // Linklar bosilganda
    document.addEventListener('click', (e) => {
      const a = e.target.closest('a.media-link');
      if (!a) return;
      e.preventDefault();
      openTelegramInternal(a.getAttribute('href'));
    });

    // Input orqali ochish
    openBtn.addEventListener('click', () => {
      const v = (urlInput.value || "").trim();
      if (!v) {
        alert("Link kiriting: https://t.me/c/....");
        return;
      }
      openTelegramInternal(v);
    });

    retryBtn.addEventListener('click', () => {
      if (lastUrl) openTelegramInternal(lastUrl);
    });

    backBtn.addEventListener('click', closeOverlay);

    // Brauzer back bosilganda overlay yopilsin
    window.addEventListener('popstate', () => {
      if (document.body.classList.contains('media-only')) closeOverlay();
    });

    // Agar URL query orqali avtomatik ochmoqchi bo‘lsangiz:
    // index.html?open=https%3A%2F%2Ft.me%2Fc%2F3086001686%2F2%2F17260
    (function autoOpenFromQuery(){
      try {
        const p = new URLSearchParams(location.search);
        const open = p.get('open');
        if (open) {
          urlInput.value = open;
          openTelegramInternal(open);
        }
      } catch (e) {}
    })();
  </script>
</body>
</html>
