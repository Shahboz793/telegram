<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>Beauty Store ‚Äî Kosmetika Do‚Äòkoni</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{
      --bg:#f3f4f6;
      --bg-soft:#e5e7eb;
      --accent:#ec4899;
      --accent-soft:#f9a8d4;
      --accent-2:#f97316;
      --text:#020617;
      --muted:#4b5563;
      --card:#ffffff;
      --border-soft:rgba(148,163,184,0.7);
      --danger:#dc2626;
    }
    body.theme-dark{
      --bg:#050816;
      --bg-soft:#0b1021;
      --accent:#ff3e92;
      --accent-soft:#ff8bd0;
      --accent-2:#ffb800;
      --text:#f9fafb;
      --muted:#9ca3af;
      --card:#111827;
      --border-soft:rgba(148,163,184,0.4);
      --danger:#ef4444;
    }
    body{
      font-family:"Poppins",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      padding-bottom:120px;
    }
    a{text-decoration:none;color:inherit}
    .hidden{display:none!important;}

    /* HEADER */
    .header{
      position:sticky;top:0;z-index:40;
      backdrop-filter:blur(18px);
      background:linear-gradient(90deg,rgba(249,250,251,0.98),rgba(229,231,235,0.98));
      border-bottom:1px solid var(--border-soft);
      padding:8px 10px 4px;
    }
    body.theme-dark .header{
      background:linear-gradient(90deg,rgba(15,23,42,0.96),rgba(24,24,27,0.9));
    }
    .header-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .logo-wrap{
      display:flex;align-items:center;gap:8px;
    }
    .logo-circle{
      width:38px;height:38px;border-radius:999px;
      background:conic-gradient(from 140deg,#fb7185,#f97316,#ede9fe,#38bdf8,#fb7185);
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 0 18px rgba(248,113,113,0.6);
    }
    .logo-circle span{
      background:#020617;
      padding:3px 10px;
      border-radius:999px;
      font-weight:700;
      font-size:14px;
      color:#f9fafb;
    }
    body.theme-dark .logo-circle span{
      background:#020617;
      color:#f9fafb;
    }
    .logo-text{
      display:flex;flex-direction:column;
      line-height:1.1;
    }
    .logo-text strong{font-size:16px;}
    .logo-text small{font-size:11px;color:var(--muted);}
    .header-right{
      display:flex;align-items:center;gap:6px;
    }
    .theme-toggle{
      border:none;
      border-radius:999px;
      padding:5px 9px;
      font-size:15px;
      cursor:pointer;
      background:#e5e7eb;
      color:#111827;
      display:flex;align-items:center;gap:4px;
    }
    body.theme-dark .theme-toggle{
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
    }
    .cart-icon-btn{
      border:none;
      border-radius:999px;
      padding:6px 10px;
      display:flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      background:radial-gradient(circle at top,#22c55e,#16a34a 50%,#14532d);
      color:#022c22;
      box-shadow:0 6px 16px rgba(34,197,94,0.55);
      font-size:13px;
    }
    .cart-icon-left{
      font-size:20px;
    }
    .cart-icon-info{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      line-height:1.1;
    }
    .cart-icon-info strong{
      font-size:13px;
    }
    .cart-icon-info small{
      font-size:11px;
      opacity:.9;
    }
    .admin-access{
      border-radius:999px;
      border:1px solid var(--border-soft);
      background:#e5e7eb;
      color:#111827;
      font-size:11px;
      padding:6px 9px;
      cursor:pointer;
    }
    body.theme-dark .admin-access{
      background:rgba(15,23,42,0.85);
      color:#e5e7eb;
    }
    .admin-access.admin-active{
      border-color:#22c55e;
      box-shadow:0 0 10px rgba(34,197,94,0.7);
    }

    /* TABS */
    .tabs{
      display:flex;
      gap:6px;
      margin-top:8px;
      font-size:12px;
    }
    .tab-btn{
      flex:1;
      border:none;
      border-radius:999px;
      padding:6px 0;
      cursor:pointer;
      background:#e5e7eb;
      color:#111827;
      border:1px solid var(--border-soft);
      font-size:12px;
    }
    body.theme-dark .tab-btn{
      background:rgba(15,23,42,0.85);
      color:#e5e7eb;
    }
    .tab-btn.active{
      background:linear-gradient(120deg,#f97316,#ec4899);
      color:#020617;
      border-color:transparent;
      font-weight:600;
      box-shadow:0 0 14px rgba(248,113,113,0.5);
    }

    /* HERO */
    .hero{
      padding:10px 14px 6px;
      background:var(--bg);
    }
    .hero-title{
      font-size:21px;
      font-weight:700;
    }
    .hero-title span{
      background:linear-gradient(120deg,#f97316,#fb7185,#e879f9);
      -webkit-background-clip:text;
      color:transparent;
    }
    .hero-sub{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
    }
    .hero-badges{
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .badge{
      font-size:10px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.45);
      background:#ffffff;
      display:flex;align-items:center;gap:4px;
      color:#111827;
    }
    body.theme-dark .badge{
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
    }
    .hero-tag{
      font-size:11px;
      margin-top:8px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:5px 10px;
      border-radius:999px;
      background:linear-gradient(90deg,rgba(56,189,248,0.2),rgba(129,140,248,0.1));
      border:1px solid rgba(59,130,246,0.55);
    }
    .hero-note{
      margin-top:6px;
      font-size:11px;
      color:var(--muted);
    }

    /* SEARCH BAR */
    .search-bar{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:6px;
      background:#ffffff;
      border-radius:999px;
      border:1px solid var(--border-soft);
      padding:4px 10px;
    }
    body.theme-dark .search-bar{
      background:rgba(15,23,42,0.9);
    }
    .search-bar span{
      font-size:16px;
    }
    .search-bar input{
      border:none;
      outline:none;
      background:transparent;
      width:100%;
      font-size:12px;
      color:var(--text);
    }
    .search-bar input::placeholder{
      color:var(--muted);
    }

    /* FILTERS */
    .filters-wrapper{
      position:sticky;
      top:90px;
      z-index:30;
      background:var(--bg);
      border-bottom:1px solid rgba(148,163,184,0.2);
    }
    .filters{
      padding:8px 12px 6px;
      display:flex;
      gap:8px;
      overflow-x:auto;
      scrollbar-width:none;
    }
    .filters::-webkit-scrollbar{display:none;}
    .chip{
      flex:0 0 auto;
      font-size:11px;
      padding:7px 12px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      background:#ffffff;
      color:#111827;
      display:flex;align-items:center;gap:6px;
      cursor:pointer;
      white-space:nowrap;
      transition:0.18s ease;
    }
    body.theme-dark .chip{
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
    }
    .chip.active{
      background:linear-gradient(120deg,#f97316,#ec4899);
      border-color:transparent;
      color:#0f172a;
      font-weight:600;
      box-shadow:0 0 14px rgba(248,113,113,0.4);
    }

    /* PRODUCTS GRID - Uzumga o‚Äòxshash katta rasmlar */
    .products-wrap{
      padding:8px 10px 90px;
      background:var(--bg-soft);
    }
    .products-grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
    }
    @media(max-width:520px){
      .products-grid{
        grid-template-columns:1fr;
      }
    }
    @media(min-width:820px){
      .products-grid{
        grid-template-columns:repeat(3,minmax(0,1fr));
      }
    }
    .product-card{
      background:var(--card);
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.7);
      overflow:hidden;
      box-shadow:0 10px 22px rgba(0,0,0,0.08);
      cursor:pointer;
      display:flex;
      flex-direction:column;
    }
    body.theme-dark .product-card{
      background:linear-gradient(145deg,#020617,var(--card));
      border-color:rgba(31,41,55,0.9);
      box-shadow:0 10px 22px rgba(0,0,0,0.7);
    }
    .product-img-wrap{
      position:relative;
      width:100%;
      padding-top:100%; /* 1:1 ‚Äî Uzum uslubidagi kvadrat katta rasm */
      overflow:hidden;
      background:#020617;
    }
    .product-img-wrap img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .product-img-tag{
      position:absolute;
      left:8px;top:8px;
      font-size:9px;
      padding:3px 7px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.7);
      display:flex;align-items:center;gap:4px;
      color:#e5e7eb;
    }
    body.theme-dark .product-img-tag{
      background:rgba(15,23,42,0.9);
    }
    .product-sale{
      position:absolute;
      right:8px;top:8px;
      background:linear-gradient(120deg,#f97316,#ec4899);
      padding:3px 10px;
      border-radius:999px;
      font-size:10px;
      font-weight:700;
      color:#111827;
    }
    .product-body{
      padding:8px 9px 10px;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .product-name{
      font-size:13px;
      font-weight:600;
      min-height:34px;
    }
    .product-meta{
      font-size:10px;
      color:var(--muted);
    }
    .tag-mini{
      font-size:9px;
      padding:3px 7px;
      border-radius:999px;
      background:#f9fafb;
      border:1px solid rgba(209,213,219,0.9);
      display:inline-flex;
      align-items:center;
      gap:4px;
      color:#111827;
      margin-top:2px;
      max-width:100%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    body.theme-dark .tag-mini{
      background:rgba(15,23,42,0.9);
      border-color:rgba(55,65,81,0.9);
      color:#e5e7eb;
    }
    .price-row{
      margin-top:6px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      font-size:12px;
    }
    .price-main{
      font-weight:700;
      font-size:13px;
    }
    .price-old{
      font-size:10px;
      color:var(--muted);
      text-decoration:line-through;
    }
    .btn-add{
      border:none;
      border-radius:999px;
      padding:7px 11px;
      font-size:11px;
      font-weight:600;
      background:linear-gradient(120deg,#22c55e,#16a34a);
      color:#022c22;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:4px;
      box-shadow:0 6px 12px rgba(34,197,94,0.35);
      flex-shrink:0;
    }
    .btn-add:active{transform:scale(.96);}

    /* BOTTOM ORDER BAR */
    .cart-bar{
      position:fixed;
      left:10px;
      right:10px;
      bottom:24px;
      background:linear-gradient(
        135deg,
        rgba(249,250,251,0.98),
        rgba(229,231,235,0.98)
      );
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.65);
      padding:8px 12px 10px;
      z-index:35;
      box-shadow:
        0 16px 32px rgba(148,163,184,0.7),
        0 0 0 1px rgba(209,213,219,0.8);
      backdrop-filter:blur(18px);
    }
    body.theme-dark .cart-bar{
      background:linear-gradient(
        135deg,
        rgba(15,23,42,0.96),
        rgba(24,24,27,0.9)
      );
      box-shadow:
        0 18px 40px rgba(0,0,0,0.8),
        0 0 0 1px rgba(15,23,42,0.8);
    }
    .cart-bar-note{
      font-size:10px;
      color:var(--muted);
      margin-bottom:5px;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .cart-bar-note::before{
      content:"‚ÑπÔ∏è";
      font-size:11px;
    }
    .cart-main-btn{
      width:100%;
      border:none;
      padding:11px 12px;
      border-radius:999px;
      background:linear-gradient(120deg,#f97316,#ec4899,#8b5cf6);
      color:#020617;
      font-size:13px;
      font-weight:700;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      cursor:pointer;
      box-shadow:
        0 14px 32px rgba(236,72,153,0.85),
        0 0 0 1px rgba(248,250,252,0.6);
    }
    .cart-main-btn:active{
      transform:scale(.97);
    }
    .cart-main-btn > div:first-child{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      line-height:1.1;
    }
    .cart-main-btn > div:first-child div{
      font-size:13px;
      letter-spacing:0.02em;
      text-transform:uppercase;
    }
    .cart-main-btn span.small{
      font-size:10px;
      font-weight:500;
      opacity:.9;
    }
    .cart-main-btn > div:last-child span{
      font-size:20px;
    }

    /* CART SHEET */
    .sheet-overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.7);
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease;
      z-index:36;
    }
    .sheet-overlay.show{
      opacity:1;
      pointer-events:auto;
    }
    .cart-sheet{
      position:fixed;
      left:0;right:0;bottom:0;
      background:radial-gradient(circle at top,#f9fafb,#e5e7eb);
      border-radius:22px 22px 0 0;
      border-top:1px solid var(--border-soft);
      max-height:75vh;
      transform:translateY(100%);
      transition:transform .25s ease;
      z-index:37;
      display:flex;
      flex-direction:column;
      box-shadow:0 -18px 30px rgba(148,163,184,0.8);
    }
    body.theme-dark .cart-sheet{
      background:radial-gradient(circle at top,#020617,#0b1021);
      box-shadow:0 -24px 36px rgba(0,0,0,0.9);
    }
    .cart-sheet.open{transform:translateY(0);}
    .cart-sheet-header{
      padding:10px 14px 8px;
      border-bottom:1px solid var(--border-soft);
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
    }
    .cart-sheet-header h3{
      font-size:13px;
      font-weight:600;
      letter-spacing:0.04em;
      text-transform:uppercase;
    }
    .cart-sheet-header button{
      border:none;
      background:#e5e7eb;
      color:#111827;
      width:26px;height:26px;
      border-radius:999px;
      cursor:pointer;
      font-size:14px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    body.theme-dark .cart-sheet-header button{
      background:rgba(15,23,42,0.85);
      color:#e5e7eb;
    }
    .cart-sheet-body{
      padding:6px 14px 4px;
      overflow-y:auto;
      max-height:48vh;
    }
    .cart-sheet-footer{
      padding:8px 14px 12px;
      border-top:1px solid var(--border-soft);
      font-size:12px;
      background:linear-gradient(
        135deg,
        rgba(249,250,251,0.98),
        rgba(219,234,254,0.98)
      );
      color:#111827;
      border-radius:0 0 22px 22px;
    }
    body.theme-dark .cart-sheet-footer{
      background:linear-gradient(
        135deg,
        rgba(15,23,42,0.96),
        rgba(30,64,175,0.9)
      );
      color:#e5e7eb;
    }
    .cart-sheet-footer-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }
    .cart-sheet-footer-top span{
      font-size:11px;
      opacity:.9;
    }
    .cart-sheet-footer-top strong{
      font-size:14px;
    }
    .cart-info-text{
      font-size:10px;
      margin-bottom:6px;
      line-height:1.4;
    }
    .cart-info-text strong{
      font-weight:600;
    }
    .cart-sheet-btn{
      width:100%;
      border:none;
      border-radius:999px;
      padding:10px 10px;
      background:linear-gradient(120deg,#22c55e,#16a34a);
      color:#022c22;
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      box-shadow:
        0 12px 28px rgba(34,197,94,0.65),
        0 0 0 1px rgba(240,253,250,0.8);
      letter-spacing:0.02em;
      text-transform:uppercase;
    }
    .cart-sheet-btn:active{
      transform:scale(.97);
    }
    .cart-empty{
      font-size:11px;
      color:var(--muted);
      text-align:center;
      padding:12px 0;
    }
    .cart-item-row{
      padding:7px 0;
      border-bottom:1px dashed rgba(75,85,99,0.6);
      display:flex;
      flex-direction:column;
      gap:5px;
      font-size:11px;
    }
    .cart-item-main{
      display:flex;
      flex-direction:column;
      gap:1px;
    }
    .cart-item-name{
      font-weight:600;
    }
    .cart-item-meta{
      font-size:10px;
      color:var(--muted);
    }
    .cart-item-actions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      font-size:10px;
    }
    .qty-control{
      display:flex;
      align-items:center;
      border-radius:999px;
      border:1px solid rgba(75,85,99,0.9);
      overflow:hidden;
    }
    .qty-control button{
      border:none;
      background:#e5e7eb;
      color:#111827;
      width:22px;height:20px;
      cursor:pointer;
      font-size:13px;
    }
    body.theme-dark .qty-control button{
      background:rgba(15,23,42,0.95);
      color:#e5e7eb;
    }
    .qty-control span{
      padding:0 7px;
      min-width:20px;
      text-align:center;
      font-size:11px;
    }
    .cart-item-total{
      font-weight:600;
    }
    .cart-remove{
      border:none;
      background:transparent;
      color:var(--danger);
      cursor:pointer;
      font-size:16px;
    }

    /* TOAST */
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:95px;
      background:rgba(15,23,42,0.98);
      border-radius:999px;
      padding:6px 12px;
      display:flex;
      align-items:center;
      gap:6px;
      font-size:11px;
      border:1px solid rgba(52,211,153,0.7);
      box-shadow:0 8px 20px rgba(22,163,74,0.75);
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease,transform .2s ease;
      z-index:50;
      color:#e5e7eb;
    }
    .toast.show{
      opacity:1;
      transform:translate(-50%, -2px);
      pointer-events:auto;
    }

    /* HISTORY PAGE */
    .page{
      padding:10px 12px 80px;
    }
    .page-title{
      font-size:16px;
      font-weight:600;
      margin-bottom:4px;
    }
    .page-sub{
      font-size:11px;
      color:var(--muted);
      margin-bottom:10px;
    }
    .history-empty{
      font-size:11px;
      color:var(--muted);
      padding:16px 0;
      text-align:center;
    }
    .order-card{
      background:var(--card);
      border-radius:12px;
      border:1px solid var(--border-soft);
      padding:8px 10px;
      margin-bottom:8px;
      font-size:11px;
      box-shadow:0 6px 16px rgba(0,0,0,0.08);
    }
    body.theme-dark .order-card{
      box-shadow:0 6px 16px rgba(0,0,0,0.6);
    }
    .order-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:4px;
    }
    .order-head strong{
      font-size:12px;
    }
    .order-meta{
      font-size:10px;
      color:var(--muted);
      margin-bottom:4px;
    }
    .order-items{
      margin-top:4px;
      padding-left:10px;
    }
    .order-items li{
      margin-bottom:2px;
    }
    .clear-history-btn{
      border:none;
      background:transparent;
      color:var(--danger);
      font-size:11px;
      text-decoration:underline;
      cursor:pointer;
      margin-bottom:6px;
    }

    /* ADMIN PAGE */
    .admin-form{
      background:var(--card);
      border-radius:12px;
      border:1px solid var(--border-soft);
      padding:8px 10px;
      font-size:11px;
      margin-bottom:10px;
      box-shadow:0 6px 14px rgba(148,163,184,0.25);
    }
    body.theme-dark .admin-form{
      box-shadow:0 6px 14px rgba(0,0,0,0.6);
    }
    .admin-form h3{
      font-size:13px;
      margin-bottom:6px;
    }
    .form-row{
      margin-bottom:6px;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .form-row label{
      font-size:10px;
      color:var(--muted);
    }
    .form-row input,
    .form-row textarea,
    .form-row select{
      border-radius:8px;
      border:1px solid rgba(148,163,184,0.7);
      padding:5px 7px;
      font-size:11px;
      background:#f9fafb;
      color:#111827;
      resize:vertical;
    }
    body.theme-dark .form-row input,
    body.theme-dark .form-row textarea,
    body.theme-dark .form-row select{
      background:rgba(15,23,42,0.7);
      color:#f9fafb;
    }
    .admin-check-row{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:10px;
      margin:4px 0 2px;
      color:var(--muted);
    }
    .admin-btn{
      border:none;
      border-radius:999px;
      padding:7px 9px;
      background:linear-gradient(120deg,#22c55e,#16a34a);
      color:#022c22;
      font-size:11px;
      font-weight:600;
      cursor:pointer;
      margin-top:4px;
    }
    .admin-info{
      font-size:10px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .admin-list-title{
      font-size:12px;
      margin:6px 0 4px;
      font-weight:600;
    }
    .admin-product-row{
      font-size:11px;
      padding:5px 0;
      border-bottom:1px dashed rgba(75,85,99,0.6);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    .admin-product-row span{
      flex:1;
    }
    .admin-delete-btn{
      border:none;
      background:transparent;
      color:var(--danger);
      cursor:pointer;
      font-size:16px;
    }

    /* PRODUCT DETAIL (Uzum-style full screen page) */
    .product-detail-overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.82);
      z-index:60;
      display:flex;
      justify-content:center;
      align-items:flex-end;
    }
    .product-detail-card{
      background:var(--card);
      color:var(--text);
      width:100%;
      max-width:520px;
      max-height:95vh;
      border-radius:20px 20px 0 0;
      overflow-y:auto;
      box-shadow:0 -18px 34px rgba(0,0,0,0.9);
    }
    @media(min-width:720px){
      .product-detail-card{
        max-height:90vh;
        border-radius:20px;
        margin-bottom:18px;
      }
    }
    .product-detail-header{
      position:relative;
    }
    .product-detail-image-wrap{
      position:relative;
      width:100%;
      padding-top:100%;
      background:#020617;
    }
    .product-detail-image-wrap img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .product-detail-close{
      position:absolute;
      top:10px;right:10px;
      border:none;
      width:32px;height:32px;
      border-radius:999px;
      background:rgba(15,23,42,0.85);
      color:#e5e7eb;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
    }
    .product-detail-body{
      padding:12px 14px 16px;
    }
    .product-detail-category{
      font-size:11px;
      color:var(--muted);
      margin-bottom:4px;
    }
    .product-detail-name{
      font-size:17px;
      font-weight:700;
      margin-bottom:6px;
    }
    .product-detail-tag{
      font-size:11px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .product-detail-desc{
      font-size:12px;
      line-height:1.5;
      margin-bottom:10px;
    }
    .product-detail-prices{
      display:flex;
      align-items:baseline;
      gap:8px;
      margin-bottom:12px;
    }
    .detail-price-main{
      font-size:16px;
      font-weight:700;
    }
    .detail-price-old{
      font-size:12px;
      color:var(--muted);
      text-decoration:line-through;
    }
    .detail-add-btn{
      width:100%;
      border:none;
      border-radius:999px;
      padding:11px 12px;
      background:linear-gradient(120deg,#22c55e,#16a34a);
      color:#022c22;
      font-size:14px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 12px 26px rgba(34,197,94,0.6);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }

  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="header-row">
      <div class="logo-wrap">
        <div class="logo-circle">
          <span>B</span>
        </div>
        <div class="logo-text">
          <strong>Beauty Store</strong>
          <small>Premium kosmetika do‚Äòkoni</small>
        </div>
      </div>
      <div class="header-right">
        <button class="theme-toggle" id="themeToggleBtn" type="button">üåô</button>
        <button class="cart-icon-btn" type="button" onclick="toggleCartSheet(true)">
          <span class="cart-icon-left">üõí</span>
          <div class="cart-icon-info">
            <strong><span id="cartCountTop">0</span> ta</strong>
            <small id="cartTotalTop">0 so‚Äòm</small>
          </div>
        </button>
        <button id="adminAccessBtn" class="admin-access" type="button">
          üëë Admin uchun
        </button>
      </div>
    </div>
    <!-- TABS -->
    <div class="tabs" id="tabs">
      <button class="tab-btn active" data-page="shopPage">Do‚Äòkon</button>
      <button class="tab-btn" data-page="historyPage">Buyurtmalar tarixi</button>
      <button class="tab-btn hidden" data-page="adminPage" id="adminTabBtn">Admin panel</button>
    </div>
  </header>

  <!-- SHOP PAGE -->
  <div id="shopPage">
    <section class="hero">
      <div class="hero-title">
        Har kuni <span>go‚Äòzallik</span> kayfiyati üí´
      </div>
      <p class="hero-sub">
        Pomada, krem, parfyum, niqob va yana ko‚Äòplab mahsulotlar ‚Äî hammasi bitta joyda.
      </p>
      <div class="hero-badges">
        <div class="badge">‚≠ê Original sifat</div>
        <div class="badge">üî• Eng ko‚Äòp sotilganlar</div>
        <div class="badge">üíå Telegram orqali buyurtma</div>
      </div>
      <div class="hero-tag">
        ‚ú® Buyurtmalar <strong>@onatili_premium</strong> ga chiroyli formatda boradi
      </div>
      <div class="hero-note">
        Buyurtma yuborilgandan keyin faqat telefon raqamingizni yozib qoldiring ‚Äî
        sotuvchi sizga tez orada qo‚Äòng‚Äòiroq qiladi.
      </div>

      <!-- QIDIRUV -->
      <div class="search-bar">
        <span>üîç</span>
        <input id="searchInput" placeholder="Mahsulot qidirish (nomi, kategoriya, tag)..." />
      </div>
    </section>

    <!-- FILTERS -->
    <div class="filters-wrapper">
      <div class="filters" id="filterBar">
        <button class="chip active" data-category="all">‚≠ê Barchasi</button>
        <button class="chip" data-category="pomada">üíÑ Pomada</button>
        <button class="chip" data-category="krem">üß¥ Kremlar</button>
        <button class="chip" data-category="parfyum">üå∏ Parfyum</button>
        <button class="chip" data-category="niqob">üò∑ Niqob / Mask</button>
        <button class="chip" data-category="ko‚Äòz">üëÅ Ko‚Äòz uchun</button>
        <button class="chip" data-category="tana">üõÅ Tana parvarishi</button>
      </div>
    </div>

    <!-- PRODUCTS -->
    <main class="products-wrap">
      <div class="products-grid" id="productsGrid"></div>
    </main>
  </div>

  <!-- HISTORY PAGE -->
  <div id="historyPage" class="page hidden">
    <div class="page-title">üìú Buyurtmalar tarixi</div>
    <p class="page-sub">
      Bu yerda shu qurilmadan yuborilgan buyurtmalaringiz ro‚Äòyxati saqlanadi
      (faqat shu brauzer / telefon uchun).
    </p>
    <button class="clear-history-btn" type="button" onclick="clearHistory()">
      Tarixni tozalash
    </button>
    <div id="historyList"></div>
  </div>

  <!-- ADMIN PAGE -->
  <div id="adminPage" class="page hidden">
    <div class="page-title">üõ† Admin panel</div>
    <p class="page-sub">
      Bu sahifa faqat admin uchun. Mahsulotlar Firestore‚Äôda saqlanadi, shuning uchun
      boshqa telefonlar ham bir xil katalogni ko‚Äòradi.
    </p>

    <div class="admin-form">
      <h3>Yangi mahsulot qo‚Äòshish</h3>
      <div class="form-row">
        <label>Mahsulot nomi</label>
        <input id="adminName" placeholder="Masalan: Luxury Lipstick Pink" />
      </div>
      <div class="form-row">
        <label>Kategoriya</label>
        <select id="adminCategory">
          <option value="pomada">Pomada / lab uchun</option>
          <option value="krem">Krem / yuz uchun</option>
          <option value="parfyum">Parfyum</option>
          <option value="niqob">Niqob / mask</option>
          <option value="ko‚Äòz">Ko‚Äòz uchun</option>
          <option value="tana">Tana / soch parvarishi</option>
        </select>
      </div>
      <div class="form-row">
        <label>Asosiy narx (chegirmadan oldin), so‚Äòm</label>
        <input id="adminPriceBase" type="number" min="0" placeholder="Masalan: 119000" />
      </div>
      <div class="admin-check-row">
        <input id="adminHasDiscount" type="checkbox" />
        <span>Chegirma bor (yangi narxni kiriting)</span>
      </div>
      <div class="form-row">
        <label>Chegirma narxi (agar belgilangan bo‚Äòlsa), so‚Äòm</label>
        <input id="adminPriceDiscount" type="number" min="0" placeholder="Masalan: 99000" />
      </div>
      <div class="form-row">
        <label>Qisqa tag / tavsiya (masalan: ‚ÄúBest seller‚Äù)</label>
        <input id="adminTag" placeholder="Masalan: Kundalik foydalanish uchun" />
      </div>
      <div class="form-row">
        <label>Batafsil tavsif (product page uchun)</label>
        <textarea id="adminDescription" rows="3" placeholder="Mahsulot nima uchun mo‚Äòljallangan, qanday ishlatiladi va hokazo."></textarea>
      </div>
      <div class="form-row">
        <label>
          Rasm nomi yoki URL  
          <small>(masalan: <b>olma</b> ‚Üí images/olma.png yoki to‚Äòliq https://...)</small>
        </label>
        <input id="adminImages" placeholder="olma yoki https://..., vergul bilan bir nechta yozish mumkin" />
      </div>
      <button class="admin-btn" type="button" onclick="addCustomProduct()">
        ‚ûï Mahsulotni qo‚Äòshish (Firestore)
      </button>
      <p class="admin-info">
        Eslatma: admin qo‚Äòshgan mahsulotlar Firestore‚Äôda saqlanadi. Hamma foydalanuvchilar bir xil katalogni ko‚Äòrishadi.
      </p>
    </div>

    <div class="admin-list-title">Firestore‚Äôdagi mahsulotlar:</div>
    <div id="adminCustomList"></div>
    <p class="admin-info">
      üî¥ O‚Äòchirsangiz, hamma foydalanuvchilar uchun o‚Äòchadi.
    </p>
  </div>

  <!-- BOTTOM ORDER BAR -->
  <div class="cart-bar">
    <div class="cart-bar-note">
      Savatdagi mahsulotlarni ko‚Äòrish va o‚Äòzgartirish uchun tepadagi üõí tugmasini yoki pastdagi tugmani bosing.
    </div>
    <button class="cart-main-btn" type="button" onclick="toggleCartSheet(true)">
      <div>
        <div>üõç Buyurtma berish</div>
        <span class="small">
          Tanlagan mahsulotlaringiz Telegram orqali sotuvchiga yuboriladi.
        </span>
      </div>
      <div><span>‚Ä∫</span></div>
    </button>
  </div>

  <!-- CART SHEET -->
  <div class="sheet-overlay" id="cartSheetOverlay" onclick="toggleCartSheet(false)"></div>
  <div class="cart-sheet" id="cartSheet">
    <div class="cart-sheet-header">
      <h3>üõí Savatingiz</h3>
      <button type="button" onclick="toggleCartSheet(false)">‚úï</button>
    </div>
    <div class="cart-sheet-body" id="cartItems"></div>
    <div class="cart-sheet-footer">
      <div class="cart-sheet-footer-top">
        <span>Umumiy summa:</span>
        <strong id="cartSheetTotal">0 so‚Äòm</strong>
      </div>
      <p class="cart-info-text">
        <strong>Izoh:</strong> ‚ÄúBuyurtmani yuborish‚Äù tugmasini bossangiz,
        hozir tanlagan mahsulotlaringiz Telegram orqali sotuvchiga jo‚Äònatiladi.
        Sotuvchi sizga telefon qilib, yetkazib berish va to‚Äòlovni kelishib oladi.
      </p>
      <button class="cart-sheet-btn" type="button" onclick="sendOrder()">
        üì© Buyurtmani yuborish (@onatili_premium)
      </button>
    </div>
  </div>

  <!-- PRODUCT DETAIL OVERLAY -->
  <div id="productDetailOverlay" class="product-detail-overlay hidden">
    <div class="product-detail-card">
      <div class="product-detail-header">
        <div class="product-detail-image-wrap">
          <img id="detailImage" src="" alt="Mahsulot rasmi" />
        </div>
        <button class="product-detail-close" type="button" onclick="closeProductDetail()">‚úï</button>
      </div>
      <div class="product-detail-body">
        <div id="detailCategory" class="product-detail-category"></div>
        <h2 id="detailName" class="product-detail-name"></h2>
        <p id="detailTag" class="product-detail-tag"></p>
        <p id="detailDesc" class="product-detail-desc"></p>
        <div class="product-detail-prices">
          <span id="detailPrice" class="detail-price-main"></span>
          <span id="detailOldPrice" class="detail-price-old hidden"></span>
        </div>
        <button id="detailAddBtn" class="detail-add-btn" type="button">
          üõí Savatga qo‚Äòshish
        </button>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast">
    ‚úÖ Savatga qo‚Äòshildi
  </div>

  <!-- FIREBASE + APP SCRIPT -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      deleteDoc,
      doc,
      serverTimestamp,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // === FIREBASE CONFIG ‚Äî SENING MA'LUMOTLARING ===
    const firebaseConfig = {
      apiKey: "AIzaSyDVidcgjpUxkg88bxXfIFzmsFydv0rMMao",
      authDomain: "shahboz-5d0a3.firebaseapp.com",
      projectId: "shahboz-5d0a3",
      storageBucket: "shahboz-5d0a3.firebasestorage.app",
      messagingSenderId: "352024095535",
      appId: "1:352024095535:web:6ca630de2c199a33c54fda",
      measurementId: "G-YS5RGZ00EB",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const productsCol = collection(db, "beauty_products");

    // === KONSTANTALAR (LOCAL STORAGE) ===
    const STORAGE_HISTORY = "beauty_order_history";
    const STORAGE_ADMIN = "beauty_admin";
    const THEME_KEY = "beauty_theme";
    const RAW_PREFIX = "https://raw.githubusercontent.com/hanbek221-design/kosmetika-premium/main/images/";

    const categoryEmoji = {
      "pomada":"üíÑ",
      "krem":"üß¥",
      "parfyum":"üå∏",
      "niqob":"üò∑",
      "ko‚Äòz":"üëÅ",
      "tana":"üõÅ",
      "default":"üíÖ"
    };

    const categoryLabel = {
      "pomada":"Pomada / lab uchun",
      "krem":"Krem / yuz uchun",
      "parfyum":"Parfyum",
      "niqob":"Niqob / mask",
      "ko‚Äòz":"Ko‚Äòz uchun",
      "tana":"Tana / soch parvarishi"
    };

    // DASTLABKI MAHSULOTLAR (default)
    const defaultProducts = [
      {
        name:"Mat pomada Nude Lux",
        price:89000,
        oldPrice:109000,
        category:"pomada",
        emoji:"üíÑ",
        tag:"Yangi kolleksiya",
        description:"Mat effektli, kundalik foydalanish uchun mos nude pomada. Lablarni quritmaydi, uzoq vaqt saqlanadi.",
        images:[
          "https://images.pexels.com/photos/3373744/pexels-photo-3373744.jpeg?auto=compress&cs=tinysrgb&w=600"
        ]
      },
      {
        name:"Qizil mat pomada Classic Red",
        price:99000,
        oldPrice:119000,
        category:"pomada",
        emoji:"üíã",
        tag:"Best seller",
        description:"Klassik qizil rang, bayram va maxsus tadbirlar uchun juda mos.",
        images:[
          "https://images.pexels.com/photos/947301/pexels-photo-947301.jpeg?auto=compress&cs=tinysrgb&w=600"
        ]
      },
      {
        name:"Gialuronli yuz kremi",
        price:129000,
        oldPrice:149000,
        category:"krem",
        emoji:"üß¥",
        tag:"Namlik 24 soat",
        description:"Quruq va normal teri uchun. Kun bo‚Äòyi namlikni ushlab turishga yordam beradi.",
        images:[
          "https://images.pexels.com/photos/3738341/pexels-photo-3738341.jpeg?auto=compress&cs=tinysrgb&w=600"
        ]
      },
      {
        name:"Kunduzgi SPF 50 krem",
        price:139000,
        oldPrice:159000,
        category:"krem",
        emoji:"üåû",
        tag:"Quyoshdan himoya",
        description:"SPF50 bilan kunduzgi krem ‚Äî quyosh nurlaridan himoya va namlantirish birgalikda.",
        images:[
          "https://images.pexels.com/photos/3738342/pexels-photo-3738342.jpeg?auto=compress&cs=tinysrgb&w=600"
        ]
      },
      {
        name:"Gul hidli ayollar parfyumi",
        price:199000,
        oldPrice:229000,
        category:"parfyum",
        emoji:"üå∏",
        tag:"Eng ko‚Äòp yoqadigan",
        description:"Yengil, mayin floral hid. Har kuni foydalanish uchun mos.",
        images:[
          "https://images.pexels.com/photos/965989/pexels-photo-965989.jpeg?auto=compress&cs=tinysrgb&w=600"
        ]
      },
      {
        name:"Maskara Waterproof",
        price:93000,
        oldPrice:109000,
        category:"ko‚Äòz",
        emoji:"üíß",
        tag:"Suvga chidamli",
        description:"Suvga chidamli maskara ‚Äî ko‚Äòz yoshlari va yomg‚Äòirga ham chidamli.",
        images:[
          "https://images.pexels.com/photos/3738367/pexels-photo-3738367.jpeg?auto=compress&cs=tinysrgb&w=600"
        ]
      }
    ];

    // === HOLAT (STATE) ===
    let products = [];           // default + Firestore
    let remoteProducts = [];     // faqat Firestore‚Äôdan kelganlar
    let cart = [];
    let activeCategory = "all";
    let currentSearch = "";
    let isAdmin = false;
    let detailIndex = null;

    // === DOM ELEMENTLAR ===
    const productsGrid = document.getElementById("productsGrid");
    const filterBar = document.getElementById("filterBar");
    const cartCountTopEl = document.getElementById("cartCountTop");
    const cartTotalTopEl = document.getElementById("cartTotalTop");
    const toastEl = document.getElementById("toast");
    const cartSheet = document.getElementById("cartSheet");
    const cartSheetOverlay = document.getElementById("cartSheetOverlay");
    const cartItemsEl = document.getElementById("cartItems");
    const cartSheetTotalEl = document.getElementById("cartSheetTotal");
    const themeToggleBtn = document.getElementById("themeToggleBtn");
    const tabsEl = document.getElementById("tabs");
    const historyListEl = document.getElementById("historyList");
    const adminCustomListEl = document.getElementById("adminCustomList");
    const adminAccessBtn = document.getElementById("adminAccessBtn");
    const adminTabBtn = document.getElementById("adminTabBtn");
    const searchInput = document.getElementById("searchInput");

    // Product detail DOM
    const productDetailOverlay = document.getElementById("productDetailOverlay");
    const detailImageEl = document.getElementById("detailImage");
    const detailCategoryEl = document.getElementById("detailCategory");
    const detailNameEl = document.getElementById("detailName");
    const detailTagEl = document.getElementById("detailTag");
    const detailDescEl = document.getElementById("detailDesc");
    const detailPriceEl = document.getElementById("detailPrice");
    const detailOldPriceEl = document.getElementById("detailOldPrice");
    const detailAddBtn = document.getElementById("detailAddBtn");

    // ADMIN INPUTS
    const adminNameEl = document.getElementById("adminName");
    const adminCategoryEl = document.getElementById("adminCategory");
    const adminPriceBaseEl = document.getElementById("adminPriceBase");
    const adminHasDiscountEl = document.getElementById("adminHasDiscount");
    const adminPriceDiscountEl = document.getElementById("adminPriceDiscount");
    const adminTagEl = document.getElementById("adminTag");
    const adminDescriptionEl = document.getElementById("adminDescription");
    const adminImagesEl = document.getElementById("adminImages");

    // === YORDAMCHI FUNKSIYALAR ===
    function formatPrice(v){
      return v.toLocaleString("uz-UZ");
    }

    function showToast(message){
      toastEl.textContent = message;
      toastEl.classList.add("show");
      setTimeout(()=> toastEl.classList.remove("show"), 1100);
    }

    function normalizeImagesInput(raw) {
      if (!raw) return [];
      return raw
        .split(",")
        .map(s => s.trim())
        .filter(Boolean)
        .map(token => {
          if (/^https?:\/\//i.test(token)) {
            return token;
          }
          const name = token.replace(/\.(png|jpg|jpeg)$/i, "");
          return RAW_PREFIX + name + ".png";
        });
    }

    function setImageWithPngJpgFallback(imgElement, url) {
      if (!url) {
        imgElement.onerror = null;
        imgElement.src = RAW_PREFIX + "noimage.png";
        return;
      }
      if (url.startsWith(RAW_PREFIX)) {
        const base = url.replace(/\.(png|jpg|jpeg)$/i, "");
        imgElement.onerror = function(){
          this.onerror = null;
          this.src = base + ".jpg";
        };
        imgElement.src = base + ".png";
      } else {
        imgElement.onerror = null;
        imgElement.src = url;
      }
    }

    function matchesSearch(p){
      if(!currentSearch) return true;
      const q = currentSearch;
      const name = (p.name || "").toLowerCase();
      const tag = (p.tag || "").toLowerCase();
      const desc = (p.description || "").toLowerCase();
      const cat = (p.category || "").toLowerCase();
      return name.includes(q) || tag.includes(q) || desc.includes(q) || cat.includes(q);
    }

    // === FIRESTORE MAHSULOTLARNI O‚ÄòQISH ===
    async function loadRemoteProducts(){
      try{
        const snap = await getDocs(productsCol);
        const list = [];
        snap.forEach(d => {
          const data = d.data();
          list.push({
            id: d.id,
            fromFirebase: true,
            name: data.name || "",
            price: data.price || 0,
            oldPrice: data.oldPrice || null,
            category: data.category || "tana",
            emoji: data.emoji || categoryEmoji[data.category] || categoryEmoji.default,
            tag: data.tag || "",
            description: data.description || "",
            images: Array.isArray(data.images) ? data.images : []
          });
        });
        remoteProducts = list;
        rebuildProducts();
        renderAdminCustomList();
      }catch(e){
        console.error("Firestore o‚Äòqishda xato:", e);
        showToast("‚ö†Ô∏è Firestore‚Äôdan yuklashda xatolik");
      }
    }

    function rebuildProducts(){
      products = [...defaultProducts, ...remoteProducts];
      renderProducts();
    }

    // === MAHSULOTLARNI CHIZISH (Uzumga o‚Äòxshash katta rasmlar) ===
    function renderProducts(){
      productsGrid.innerHTML = "";
      const filtered = products.filter(p =>
        (activeCategory === "all" ? true : p.category === activeCategory) &&
        matchesSearch(p)
      );
      if(!filtered.length){
        productsGrid.innerHTML = "<p class='history-empty'>Bu filtrlarda mahsulot topilmadi.</p>";
        return;
      }
      filtered.forEach(p=>{
        const index = products.indexOf(p);
        const discount = p.oldPrice && p.oldPrice > p.price
          ? (100 - Math.round(p.price*100/p.oldPrice))
          : null;
        const tag = p.tag || "Ommabop mahsulot";
        const firstImage = (p.images && p.images.length) ? p.images[0] : RAW_PREFIX + "noimage.png";

        let imgHtml;
        if (firstImage.startsWith(RAW_PREFIX)) {
          const base = firstImage.replace(/\.(png|jpg|jpeg)$/i, "");
          imgHtml = `<img src="${base}.png" alt="${p.name}" onerror="this.onerror=null;this.src='${base}.jpg';">`;
        } else {
          imgHtml = `<img src="${firstImage}" alt="${p.name}">`;
        }

        productsGrid.innerHTML += `
          <article class="product-card" onclick="openProductDetail(${index})">
            <div class="product-img-wrap">
              ${imgHtml}
              <div class="product-img-tag">
                <span>Beauty</span><span>Pro</span>
              </div>
              ${discount ? `<div class="product-sale">-${discount}%</div>` : ``}
            </div>
            <div class="product-body">
              <div class="product-name">${p.name}</div>
              <div class="product-meta">
                ${(categoryLabel[p.category] || p.category)} ‚Ä¢ ${tag}
              </div>
              <div class="tag-mini">
                üí° ${tag}
              </div>
              <div class="price-row">
                <div>
                  <div class="price-main">${formatPrice(p.price)} so‚Äòm</div>
                  ${p.oldPrice ? `<div class="price-old">${formatPrice(p.oldPrice)} so‚Äòm</div>` : ``}
                </div>
                <button class="btn-add" onclick="event.stopPropagation(); addToCart(${index});">
                  ‚ûï Savatga
                </button>
              </div>
            </div>
          </article>
        `;
      });
    }

    // === FILTER KLIK ===
    filterBar.addEventListener("click", (e)=>{
      const btn = e.target.closest(".chip");
      if(!btn) return;
      document.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
      btn.classList.add("active");
      activeCategory = btn.dataset.category;
      renderProducts();
    });

    // === QIDIRUV ===
    searchInput.addEventListener("input", ()=>{
      currentSearch = searchInput.value.trim().toLowerCase();
      renderProducts();
    });

    // === SAVAT FUNKSIYALARI ===
    function addToCart(index){
      const found = cart.find(c => c.index === index);
      if(found){
        found.qty += 1;
      }else{
        cart.push({index, qty:1});
      }
      updateCartUI();
      showToast("‚úÖ Savatga qo‚Äòshildi");
    }

    function updateCartUI(){
      let totalCount = 0;
      let totalPrice = 0;
      cart.forEach(c=>{
        const p = products[c.index];
        if(!p) return;
        totalCount += c.qty;
        totalPrice += p.price * c.qty;
      });
      cartCountTopEl.textContent = totalCount;
      cartTotalTopEl.textContent = formatPrice(totalPrice) + " so‚Äòm";
      if(cartSheet.classList.contains("open")){
        renderCartItems();
      }
    }

    function toggleCartSheet(force){
      const isOpen = cartSheet.classList.contains("open");
      const next = typeof force === "boolean" ? force : !isOpen;
      cartSheet.classList.toggle("open", next);
      cartSheetOverlay.classList.toggle("show", next);
      if(next){
        renderCartItems();
      }
    }

    function renderCartItems(){
      if(cart.length === 0){
        cartItemsEl.innerHTML = "<p class='cart-empty'>Savat hozircha bo‚Äòsh üôÇ</p>";
        cartSheetTotalEl.textContent = "0 so‚Äòm";
        return;
      }
      let html = "";
      let total = 0;
      cart.forEach(c=>{
        const p = products[c.index];
        if(!p) return;
        const lineTotal = p.price * c.qty;
        total += lineTotal;
        html += `
          <div class="cart-item-row">
            <div class="cart-item-main">
              <div class="cart-item-name">${p.name}</div>
              <div class="cart-item-meta">
                ${formatPrice(p.price)} so‚Äòm ‚Ä¢ ${(categoryLabel[p.category] || p.category)}
              </div>
            </div>
            <div class="cart-item-actions">
              <div class="qty-control">
                <button onclick="changeQty(${c.index}, -1)">-</button>
                <span>${c.qty}</span>
                <button onclick="changeQty(${c.index}, 1)">+</button>
              </div>
              <div class="cart-item-total">${formatPrice(lineTotal)} so‚Äòm</div>
              <button class="cart-remove" onclick="removeFromCart(${c.index})">‚úï</button>
            </div>
          </div>
        `;
      });
      cartItemsEl.innerHTML = html;
      cartSheetTotalEl.textContent = formatPrice(total) + " so‚Äòm";
    }

    function changeQty(productIndex, delta){
      const item = cart.find(c => c.index === productIndex);
      if(!item) return;
      item.qty += delta;
      if(item.qty <= 0){
        cart = cart.filter(c=>c.index !== productIndex);
      }
      updateCartUI();
      renderCartItems();
    }

    function removeFromCart(productIndex){
      cart = cart.filter(c=>c.index !== productIndex);
      updateCartUI();
      renderCartItems();
    }

    function openTelegramLink(url){
      const tg = window.Telegram && window.Telegram.WebApp;
      try{
        if(tg && typeof tg.openTelegramLink === "function"){
          tg.openTelegramLink(url);
        }else{
          window.open(url, "_blank");
        }
      }catch(e){
        window.location.href = url;
      }
    }

    // === BUYURTMA TARIXI (LOCAL) ===
    function saveOrderHistory(order){
      let list = [];
      try{
        list = JSON.parse(localStorage.getItem(STORAGE_HISTORY) || "[]");
      }catch(e){}
      list.unshift(order);
      localStorage.setItem(STORAGE_HISTORY, JSON.stringify(list));
      renderHistory();
    }

    function renderHistory(){
      let list = [];
      try{
        list = JSON.parse(localStorage.getItem(STORAGE_HISTORY) || "[]");
      }catch(e){}
      if(!list.length){
        historyListEl.innerHTML = "<p class='history-empty'>Hozircha buyurtmalar tarixi bo‚Äòsh.</p>";
        return;
      }
      historyListEl.innerHTML = "";
      list.forEach((order, idx)=>{
        const date = new Date(order.date);
        const dateStr = date.toLocaleString("uz-UZ");
        let itemsHtml = "";
        order.items.forEach(it=>{
          itemsHtml += `<li>${it.line}</li>`;
        });
        historyListEl.innerHTML += `
          <div class="order-card">
            <div class="order-head">
              <strong>Buyurtma #${list.length - idx}</strong>
              <span>${order.totalFormatted}</span>
            </div>
            <div class="order-meta">
              üìÖ ${dateStr} ‚Ä¢ üß∫ ${order.totalItems} ta mahsulot
            </div>
            <div>Mahsulotlar:</div>
            <ul class="order-items">
              ${itemsHtml}
            </ul>
          </div>
        `;
      });
    }

    function clearHistory(){
      if(confirm("Buyurtmalar tarixini tozalashni xohlaysizmi?")){
        localStorage.removeItem(STORAGE_HISTORY);
        renderHistory();
      }
    }

    // === TELEGRAMGA BUYURTMA JO‚ÄòNATISH ===
    function sendOrder(){
      if(cart.length === 0){
        showToast("Savat bo‚Äòsh. Avval mahsulot tanlang üôÇ");
        return;
      }
      let totalPrice = 0;
      let totalItems = 0;
      let lines = [];
      cart.forEach((c, i)=>{
        const p = products[c.index];
        if(!p) return;
        const lineTotal = p.price * c.qty;
        totalPrice += lineTotal;
        totalItems += c.qty;
        const catEmoji = categoryEmoji[p.category] || p.emoji || categoryEmoji.default;
        const lineText =
          `${i+1}) ${catEmoji} ${p.name} ‚Äî ${c.qty} dona √ó ${formatPrice(p.price)} so‚Äòm = ${formatPrice(lineTotal)} so‚Äòm`;
        lines.push({line: lineText, product: p});
      });
      const totalStr = formatPrice(totalPrice);
      let text = "";
      text += "üíñ BEAUTY STORE ‚Äî Onlayn buyurtma\n";
      text += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
      text += "üß∫ Savatimdagi mahsulotlar:\n\n";
      lines.forEach(l=>{
        text += "‚Ä¢ " + l.line + "\n";
      });
      text += "\nüí∞ Umumiy summa: " + totalStr + " so‚Äòm\n";
      text += "üì¶ Buyurtma turi: Kosmetika mahsulotlari\n";
      text += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
      text += "üì± Telefon raqamim: _______\n";
      text += "üìç Manzilim: _______\n";
      text += "‚úçÔ∏è Iltimos, ushbu ma'lumotlarni to‚Äòldirib, xabarni yuboring.\n";

      const encoded = encodeURIComponent(text);
      const url = "https://t.me/onatili_premium?text=" + encoded + "&t=" + Date.now();

      const order = {
        date: new Date().toISOString(),
        totalPrice: totalPrice,
        totalFormatted: totalStr + " so‚Äòm",
        totalItems: totalItems,
        items: lines
      };
      saveOrderHistory(order);
      openTelegramLink(url);
      cart = [];
      updateCartUI();
      renderCartItems();
      toggleCartSheet(false);
      showToast("‚úÖ Buyurtma matni Telegramga tayyorlandi.");
    }

    // === TEMA (DARK / LIGHT) ===
    function applyTheme(theme){
      document.body.classList.toggle("theme-dark", theme === "dark");
      themeToggleBtn.textContent = theme === "dark" ? "‚òÄÔ∏è" : "üåô";
    }
    function toggleTheme(){
      const current = localStorage.getItem(THEME_KEY) || "light";
      const next = current === "dark" ? "light" : "dark";
      localStorage.setItem(THEME_KEY, next);
      applyTheme(next);
    }
    themeToggleBtn.addEventListener("click", toggleTheme);

    // === TABS ===
    tabsEl.addEventListener("click", (e)=>{
      const btn = e.target.closest(".tab-btn");
      if(!btn) return;
      const pageId = btn.dataset.page;
      if(pageId === "adminPage" && !isAdmin){
        showToast("üëë Avval admin kodini kiriting.");
        return;
      }
      document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById("shopPage").classList.add("hidden");
      document.getElementById("historyPage").classList.add("hidden");
      document.getElementById("adminPage").classList.add("hidden");
      document.getElementById(pageId).classList.remove("hidden");
      if(pageId === "historyPage"){
        renderHistory();
      }else if(pageId === "adminPage"){
        renderAdminCustomList();
      }
    });

    // === ADMIN LOGIN ===
    function updateAdminUI(){
      if(isAdmin){
        adminTabBtn.classList.remove("hidden");
        adminAccessBtn.classList.add("admin-active");
        adminAccessBtn.textContent = "üëë Admin (kirdingiz)";
      }else{
        adminTabBtn.classList.add("hidden");
        adminAccessBtn.classList.remove("admin-active");
        adminAccessBtn.textContent = "üëë Admin uchun";
      }
    }
    function askAdminCode(){
      if(isAdmin){
        document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
        adminTabBtn.classList.add("active");
        document.getElementById("shopPage").classList.add("hidden");
        document.getElementById("historyPage").classList.add("hidden");
        document.getElementById("adminPage").classList.remove("hidden");
        renderAdminCustomList();
        return;
      }
      const code = prompt("Admin uchun kirish kodi:");
      if(code === null) return;
      if(code === "12345678"){
        isAdmin = true;
        localStorage.setItem(STORAGE_ADMIN, "true");
        updateAdminUI();
        showToast("‚úÖ Admin sifatida kirdingiz");
      }else{
        showToast("‚ùå Noto‚Äòg‚Äòri kod");
      }
    }
    adminAccessBtn.addEventListener("click", askAdminCode);

    // === ADMIN CUSTOM MAHSULOTLAR (Firestore) ===
    async function addCustomProduct(){
      const name = adminNameEl.value.trim();
      const category = adminCategoryEl.value;
      const basePrice = parseInt(adminPriceBaseEl.value, 10);
      const hasDiscount = adminHasDiscountEl.checked;
      const discountPriceRaw = adminPriceDiscountEl.value ? parseInt(adminPriceDiscountEl.value, 10) : null;
      const tag = adminTagEl.value.trim();
      const description = adminDescriptionEl.value.trim();
      if(!name || !basePrice || basePrice <= 0){
        alert("Mahsulot nomi va asosiy narxini to‚Äòg‚Äòri kiriting.");
        return;
      }
      let price = basePrice;
      let oldPrice = null;
      if(hasDiscount && discountPriceRaw && discountPriceRaw > 0 && discountPriceRaw < basePrice){
        price = discountPriceRaw;
        oldPrice = basePrice;
      }
      let images = normalizeImagesInput(adminImagesEl.value.trim());
      if(!images.length){
        images = [RAW_PREFIX + "noimage.png"];
      }
      const emoji = categoryEmoji[category] || categoryEmoji.default;

      const payload = {
        name,
        price,
        oldPrice,
        category,
        emoji,
        tag,
        description,
        images,
        createdAt: serverTimestamp()
      };

      try{
        const docRef = await addDoc(productsCol, payload);
        remoteProducts.push({
          ...payload,
          id: docRef.id,
          fromFirebase:true
        });
        rebuildProducts();
        renderAdminCustomList();
        adminNameEl.value = "";
        adminPriceBaseEl.value = "";
        adminPriceDiscountEl.value = "";
        adminHasDiscountEl.checked = false;
        adminTagEl.value = "";
        adminDescriptionEl.value = "";
        adminImagesEl.value = "";
        showToast("‚úÖ Mahsulot Firestore‚Äôga yozildi");
      }catch(e){
        console.error("Mahsulot qo‚Äòshishda xato:", e);
        showToast("‚ö†Ô∏è Firestore‚Äôga yozishda xato");
      }
    }

    async function deleteAnyProduct(id){
      if(!confirm("Bu mahsulotni o‚Äòchirishni xohlaysizmi? Hamma uchun o‚Äòchadi.")) return;
      try{
        await deleteDoc(doc(db,"beauty_products",id));
        remoteProducts = remoteProducts.filter(p=>p.id !== id);
        rebuildProducts();
        renderAdminCustomList();
        showToast("üóë Mahsulot o‚Äòchirildi");
      }catch(e){
        console.error("O‚Äòchirishda xato:", e);
        showToast("‚ö†Ô∏è Firestore‚Äôdan o‚Äòchirishda xato");
      }
    }

    function renderAdminCustomList(){
      if(!remoteProducts.length){
        adminCustomListEl.innerHTML = "<p class='history-empty'>Hozircha Firestore‚Äôda admin qo‚Äòshgan mahsulot yo‚Äòq.</p>";
        return;
      }
      adminCustomListEl.innerHTML = "";
      remoteProducts
        .slice()
        .sort((a,b)=> (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0))
        .forEach(p=>{
          adminCustomListEl.innerHTML += `
            <div class="admin-product-row">
              <span>${p.name}</span>
              <span>${formatPrice(p.price)} so‚Äòm</span>
              <button class="admin-delete-btn" onclick="deleteAnyProduct('${p.id}')">‚úï</button>
            </div>
          `;
        });
    }

    // === PRODUCT DETAIL (Uzum-style full page) ===
    function openProductDetail(index){
      const p = products[index];
      if(!p) return;
      detailIndex = index;
      const catLabel = categoryLabel[p.category] || p.category;
      const img = (p.images && p.images.length) ? p.images[0] : RAW_PREFIX + "noimage.png";

      setImageWithPngJpgFallback(detailImageEl, img);
      detailCategoryEl.textContent = catLabel;
      detailNameEl.textContent = p.name;
      detailTagEl.textContent = p.tag ? "üí° " + p.tag : "";
      detailDescEl.textContent =
        p.description && p.description.trim().length
          ? p.description
          : "Bu mahsulot sizning go‚Äòzallik rutiningiz uchun mo‚Äòljallangan. Admin paneldan batafsil tavsif yozib qo‚Äòyishingiz mumkin.";
      detailPriceEl.textContent = formatPrice(p.price) + " so‚Äòm";
      if(p.oldPrice){
        detailOldPriceEl.textContent = formatPrice(p.oldPrice) + " so‚Äòm";
        detailOldPriceEl.classList.remove("hidden");
      }else{
        detailOldPriceEl.classList.add("hidden");
      }
      productDetailOverlay.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    }

    function closeProductDetail(){
      productDetailOverlay.classList.add("hidden");
      document.body.style.overflow = "";
      detailIndex = null;
    }

    detailAddBtn.addEventListener("click", ()=>{
      if(detailIndex === null) return;
      addToCart(detailIndex);
    });

    productDetailOverlay.addEventListener("click",(e)=>{
      if(e.target === productDetailOverlay){
        closeProductDetail();
      }
    });

    // === INIT ===
    (function init(){
      const savedTheme = localStorage.getItem(THEME_KEY) || "light";
      applyTheme(savedTheme);
      isAdmin = localStorage.getItem(STORAGE_ADMIN) === "true";
      updateAdminUI();
      // Avval defaultlar
      rebuildProducts();
      renderHistory();
      // Keyin Firestore‚Äôdan yuklab ustiga qo‚Äòshamiz
      loadRemoteProducts();
    })();

    // === GLOBAL FUNKSIYALAR (onclick uchun) ===
    window.addToCart = addToCart;
    window.toggleCartSheet = toggleCartSheet;
    window.changeQty = changeQty;
    window.removeFromCart = removeFromCart;
    window.sendOrder = sendOrder;
    window.clearHistory = clearHistory;
    window.openProductDetail = openProductDetail;
    window.closeProductDetail = closeProductDetail;
    window.deleteAnyProduct = deleteAnyProduct;
  </script>
</body>
</html>
