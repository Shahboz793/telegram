<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BrandNomi — Sayt (Login & Ro'yxatga olish)</title>
  <meta name="description" content="Ro'yxatdan o'tish, login va F.I.SH orqali parolni tiklash tizimi (localStorage)." />
  <style>
    :root{--bg:#0b1220;--card:#0f172a;--text:#e2e8f0;--muted:#94a3b8;--primary:#38bdf8;--accent:#22d3ee;--border:#1e293b;--shadow:0 12px 30px rgba(8,15,40,.35);--radius:14px}
    *{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text)}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700}
    .btn{background:var(--primary);color:white;padding:8px 12px;border-radius:10px;border:0;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.08)}
    .card{background:var(--card);border-radius:12px;padding:16px;border:1px solid var(--border);box-shadow:var(--shadow)}
    .auth-panel{position:fixed;inset:0;display:grid;place-items:center;background:rgba(2,6,23,.6);z-index:60}
    .auth{width:360px;background:var(--card);padding:18px;border-radius:12px;border:1px solid var(--border)}
    .tabs{display:flex;gap:6px;margin-bottom:12px}
    .tabs button{flex:1;padding:8px;border-radius:8px;border:0;background:transparent;color:var(--muted);cursor:pointer}
    .tabs button.active{background:linear-gradient(90deg,var(--primary),var(--accent));color:#022}
    .field{display:grid;margin-bottom:10px}
    .field label{font-size:13px;color:var(--muted);margin-bottom:6px}
    .field input{padding:10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text)}
    .hint{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <header class="container">
    <div class="logo">BrandNomi</div>
    <div id="headerRight"></div>
  </header>

  <main class="container">
    <div id="welcome" class="card">
      <h2>Saytga xush kelibsiz</h2>
      <p class="hint">Ro'yxatdan o'ting yoki tizimga kiring. Parolingizni unutdingizmi? — F.I.SH orqali tiklash mumkin.</p>
    </div>
    <div id="userArea" class="card" style="margin-top:20px"></div>
  </main>

  <div id="authPanel" class="auth-panel">
    <div class="auth card">
      <div class="tabs">
        <button id="tabLogin" type="button" class="active">Kirish</button>
        <button id="tabRegister" type="button">Ro'yxatdan o'tish</button>
        <button id="tabReset" type="button">Parolni tiklash</button>
      </div>

      <form id="loginForm">
        <div class="field"><label>Login</label><input id="login_username" required></div>
        <div class="field"><label>Parol</label><input id="login_password" type="password" required></div>
        <button class="btn" type="submit">Kirish</button>
        <p id="loginMsg" class="hint"></p>
      </form>

      <form id="registerForm" style="display:none">
        <div class="field"><label>F.I.SH</label><input id="reg_fullname" required></div>
        <div class="field"><label>Login</label><input id="reg_username" required></div>
        <div class="field"><label>Parol</label><input id="reg_password" type="password" required></div>
        <button class="btn" type="submit">Ro'yxatdan o'tish</button>
        <p id="regMsg" class="hint"></p>
      </form>

      <form id="resetForm" style="display:none">
        <div class="field"><label>F.I.SH</label><input id="reset_fullname" required></div>
        <div class="field"><label>Yangi parol</label><input id="reset_newpass" type="password" required></div>
        <button class="btn" type="submit">Tiklash</button>
        <p id="resetMsg" class="hint"></p>
      </form>
    </div>
  </div>

  <script>
    const LS_USERS='bn_users_v1', LS_CUR='bn_current_v1';
    const users=()=>JSON.parse(localStorage.getItem(LS_USERS)||'{}');
    const save=u=>localStorage.setItem(LS_USERS,JSON.stringify(u));
    const cur=()=>localStorage.getItem(LS_CUR);
    const setCur=u=>localStorage.setItem(LS_CUR,u);
    const clearCur=()=>localStorage.removeItem(LS_CUR);

    async function hashString(s){const data=new TextEncoder().encode(s);const h=await crypto.subtle.digest('SHA-256',data);return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join('');}

    const tabLogin=document.getElementById('tabLogin');
    const tabRegister=document.getElementById('tabRegister');
    const tabReset=document.getElementById('tabReset');
    const loginForm=document.getElementById('loginForm');
    const regForm=document.getElementById('registerForm');
    const resetForm=document.getElementById('resetForm');

    tabLogin.onclick=()=>{show('login')};
    tabRegister.onclick=()=>{show('register')};
    tabReset.onclick=()=>{show('reset')};
    function show(x){
      [tabLogin,tabRegister,tabReset].forEach(t=>t.classList.remove('active'));
      loginForm.style.display=regForm.style.display=resetForm.style.display='none';
      if(x==='login'){tabLogin.classList.add('active');loginForm.style.display='block';}
      if(x==='register'){tabRegister.classList.add('active');regForm.style.display='block';}
      if(x==='reset'){tabReset.classList.add('active');resetForm.style.display='block';}
    }

    regForm.onsubmit=async e=>{
      e.preventDefault();
      const u=users();
      const f=reg_fullname.value.trim();
      const l=reg_username.value.trim();
      const p=reg_password.value;
      if(u[l])return regMsg.textContent='Bu login allaqachon mavjud.';
      u[l]={fullname:f,username:l,passwordHash:await hashString(p)};
      save(u);setCur(l);
      document.getElementById('authPanel').style.display='none';
      render();
    }

    loginForm.onsubmit=async e=>{
      e.preventDefault();
      const u=users();
      const l=login_username.value.trim();
      const p=login_password.value;
      if(!u[l])return loginMsg.textContent='Login topilmadi';
      if(u[l].passwordHash!==await hashString(p))return loginMsg.textContent='Parol xato';
      setCur(l);
      document.getElementById('authPanel').style.display='none';
      render();
    }

    resetForm.onsubmit=async e=>{
      e.preventDefault();
      const u=users();
      const f=reset_fullname.value.trim();
      const newp=reset_newpass.value;
      let found=null;
      for(const k in u){if(u[k].fullname===f){found=k;break}}
      if(!found)return resetMsg.textContent='Bunday ismli foydalanuvchi topilmadi.';
      u[found].passwordHash=await hashString(newp);
      save(u);
      resetMsg.textContent='Parol tiklandi! Endi kirishingiz mumkin.';
    }

    function render(){
      const div=document.getElementById('userArea');
      const u=users();
      const c=cur();
      if(!c){div.innerHTML='<button class="btn" onclick="document.getElementById(\'authPanel\').style.display=\'grid\'">Kirish / Ro\'yxatdan o\'tish</button>';return;}
      div.innerHTML=`<p>Foydalanuvchi: <b>${u[c].fullname}</b> (@${c})</p><button class="btn" onclick="clearCur();render()">Chiqish</button>`;
    }
    render();
  </script>
</body>
</html>
