<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BrandNomi â€” Foydalanuvchi profili tahriri bilan sayt</title>
  <style>
    :root{--bg:#0b1220;--card:#0f172a;--text:#e2e8f0;--muted:#94a3b8;--primary:#38bdf8;--accent:#22d3ee;--border:#1e293b;--shadow:0 12px 30px rgba(8,15,40,.35);--radius:14px}
    *{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text)}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .logo{font-weight:700;font-size:20px}
    .btn{background:var(--primary);color:white;padding:8px 12px;border-radius:10px;border:0;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.18);color:var(--text)}
    .card{background:var(--card);border-radius:12px;padding:16px;border:1px solid var(--border);box-shadow:var(--shadow)}
    .auth-panel{position:fixed;inset:0;display:grid;place-items:center;background:rgba(2,6,23,.6);z-index:60}
    .auth{width:380px;background:var(--card);padding:18px;border-radius:12px;border:1px solid var(--border)}
    .tabs{display:flex;gap:6px;margin-bottom:12px}
    .tabs button{flex:1;padding:8px;border-radius:8px;border:0;background:transparent;color:var(--muted);cursor:pointer}
    .tabs button.active{background:linear-gradient(90deg,var(--primary),var(--accent));color:#022}
    .field{display:grid;margin-bottom:10px}
    .field label{font-size:13px;color:var(--muted);margin-bottom:6px}
    .field input{padding:10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text)}
    .hint{font-size:13px;color:var(--muted)}
    .row{display:flex;gap:12px;align-items:center}
    .avatar{width:56px;height:56px;border-radius:50%;display:grid;place-items:center;font-weight:800;letter-spacing:.5px;color:#0b1220;user-select:none}
    .avatar.lg{width:72px;height:72px;font-size:20px}
  </style>
</head>
<body>
  <header class="container">
    <div class="logo">BrandNomi</div>
    <div id="headerRight"></div>
  </header>

  <main class="container">
    <div id="welcome" class="card">
      <h2>Profil tahriri + avatar (bosh harflar) bilan sayt</h2>
      <p class="hint">Login, parol, F.I.SH ni oâ€˜zgartiring. Avatar rasm oâ€˜rniga ism bosh harflari doira ichida rangli belgida koâ€˜rsatiladi.</p>
    </div>

    <div id="userArea" class="card" style="margin-top:20px"></div>
  </main>

  <div id="authPanel" class="auth-panel">
    <div class="auth card">
      <div class="tabs">
        <button id="tabLogin" type="button" class="active">Kirish</button>
        <button id="tabRegister" type="button">Ro'yxatdan o'tish</button>
        <button id="tabReset" type="button">Parolni tiklash</button>
      </div>

      <form id="loginForm">
        <div class="field"><label>Login</label><input id="login_username" required></div>
        <div class="field"><label>Parol</label><input id="login_password" type="password" required></div>
        <button class="btn" type="submit">Kirish</button>
        <p id="loginMsg" class="hint"></p>
      </form>

      <form id="registerForm" style="display:none">
        <div class="field"><label>F.I.SH</label><input id="reg_fullname" required></div>
        <div class="field"><label>Login</label><input id="reg_username" required></div>
        <div class="field"><label>Parol</label><input id="reg_password" type="password" required></div>
        <button class="btn" type="submit">Ro'yxatdan o'tish</button>
        <p id="regMsg" class="hint"></p>
      </form>

      <form id="resetForm" style="display:none">
        <div class="field"><label>F.I.SH</label><input id="reset_fullname" required></div>
        <div class="field"><label>Yangi parol</label><input id="reset_newpass" type="password" required></div>
        <div class="field row" style="justify-content:space-between">
          <button class="btn" type="submit">Tiklash</button>
          <button class="btn ghost" type="button" id="remindLoginBtn">Loginni eslatish</button>
        </div>
        <p id="resetMsg" class="hint"></p>
      </form>
    </div>
  </div>

  <div id="editPanel" class="auth-panel" style="display:none">
    <div class="auth card">
      <h3 class="row"><span class="avatar lg" id="editAvatar">AA</span> Profilni tahrirlash</h3>
      <form id="editForm">
        <div class="field"><label>Yangi F.I.SH</label><input id="edit_fullname" required></div>
        <div class="field"><label>Yangi login</label><input id="edit_username" required></div>
        <div class="field"><label>Yangi parol</label><input id="edit_password" type="password" required></div>
        <div class="row" style="justify-content:space-between">
          <button class="btn" type="submit">Saqlash</button>
          <button class="btn ghost" type="button" onclick="document.getElementById('editPanel').style.display='none'">Bekor qilish</button>
        </div>
        <p id="editMsg" class="hint"></p>
      </form>
    </div>
  </div>

 <script>
  const LS_USERS='bn_users_v1', LS_CUR='bn_current_v1';
  const users=()=>JSON.parse(localStorage.getItem(LS_USERS)||'{}');
  const save=u=>localStorage.setItem(LS_USERS,JSON.stringify(u));
  const cur=()=>sessionStorage.getItem(LS_CUR); // ðŸ‘‰ endi faqat sessiya davomida
  const setCur=u=>sessionStorage.setItem(LS_CUR,u); // sessiya tugasa oâ€˜chadi
  const clearCur=()=>sessionStorage.removeItem(LS_CUR);

  async function hashString(s){
    const data=new TextEncoder().encode(s);
    const h=await crypto.subtle.digest('SHA-256',data);
    return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join('');
  }

  function initialsFrom(fullname=''){
    const parts=(fullname||'').trim().toUpperCase().split(/\s+/).filter(Boolean);
    if(parts.length===0)return'??';
    if(parts.length===1)return parts[0].slice(0,2);
    return(parts[0][0]||'')+(parts[1][0]||'');
  }
  function pastelFromSeed(seed=''){
    let h=0;for(let i=0;i<seed.length;i++){h=(h*31+seed.charCodeAt(i))>>>0}
    h=h%360;return`hsl(${h} 70% 70%)`;
  }

  const tabLogin=document.getElementById('tabLogin');
  const tabRegister=document.getElementById('tabRegister');
  const tabReset=document.getElementById('tabReset');
  const loginForm=document.getElementById('loginForm');
  const regForm=document.getElementById('registerForm');
  const resetForm=document.getElementById('resetForm');

  tabLogin.onclick=()=>show('login');
  tabRegister.onclick=()=>show('register');
  tabReset.onclick=()=>show('reset');

  function show(x){
    [tabLogin,tabRegister,tabReset].forEach(t=>t.classList.remove('active'));
    loginForm.style.display=regForm.style.display=resetForm.style.display='none';
    if(x==='login'){tabLogin.classList.add('active');loginForm.style.display='block';}
    if(x==='register'){tabRegister.classList.add('active');regForm.style.display='block';}
    if(x==='reset'){tabReset.classList.add('active');resetForm.style.display='block';}
  }

  regForm.onsubmit=async e=>{
    e.preventDefault();
    const u=users();
    const f=reg_fullname.value.trim().toLowerCase();
    const l=reg_username.value.trim().toLowerCase();
    const p=reg_password.value;
    if(u[l]){regMsg.textContent='Bu login allaqachon mavjud.';return;}
    const avatarColor=pastelFromSeed(l);
    u[l]={fullname:f,username:l,passwordHash:await hashString(p),avatarColor};
    save(u);setCur(l);
    document.getElementById('authPanel').style.display='none';render();
  }

  loginForm.onsubmit=async e=>{
    e.preventDefault();
    const u=users();
    const l=login_username.value.trim().toLowerCase();
    const p=login_password.value;
    if(!u[l]){loginMsg.textContent='Login topilmadi';return}
    if(u[l].passwordHash!==await hashString(p)){loginMsg.textContent='Parol xato';return}
    setCur(l);
    document.getElementById('authPanel').style.display='none';render();
  }

  resetForm.onsubmit=async e=>{
    e.preventDefault();
    const u=users();
    const f=reset_fullname.value.trim().toLowerCase();
    const newp=reset_newpass.value;
    let found=null;
    for(const k in u){if(u[k].fullname===f){found=k;break}}
    if(!found){resetMsg.textContent='Bunday ismli foydalanuvchi topilmadi.';return}
    u[found].passwordHash=await hashString(newp);
    save(u);
    resetMsg.textContent='Parol tiklandi! Endi kirishingiz mumkin.';
  }

  document.getElementById('remindLoginBtn').onclick=()=>{
    const u=users();
    const f=reset_fullname.value.trim().toLowerCase();
    if(!f){resetMsg.textContent='Avval F.I.SH kiriting.';return}
    const matches=Object.values(u).filter(x=>x.fullname===f);
    if(matches.length===0){resetMsg.textContent='Bunday F.I.SH topilmadi.';return}
    if(matches.length===1){resetMsg.textContent='Sizning login: @'+matches[0].username;return}
    resetMsg.textContent='Bir nechta mos foydalanuvchi: '+matches.map(m=>'@'+m.username).join(', ');
  }

  document.getElementById('editForm').onsubmit=async e=>{
    e.preventDefault();
    const u=users();
    const c=cur();if(!c)return;
    const newFull=edit_fullname.value.trim().toLowerCase();
    const newUser=edit_username.value.trim().toLowerCase();
    const newPass=edit_password.value;
    if(newUser!==c&&u[newUser]){editMsg.textContent='Bu login allaqachon mavjud.';return}
    const oldColor=(u[c]&&u[c].avatarColor)?u[c].avatarColor:pastelFromSeed(c);
    const avatarColor=(newUser===c)?oldColor:pastelFromSeed(newUser);
    const updated={fullname:newFull,username:newUser,passwordHash:await hashString(newPass),avatarColor};
    delete u[c];u[newUser]=updated;save(u);setCur(newUser);
    editMsg.textContent='Maâ€™lumotlar yangilandi!';
    setTimeout(()=>{document.getElementById('editPanel').style.display='none';render();},800);
  }

  function render(){
    const div=document.getElementById('userArea');
    const u=users();
    const c=cur();
    if(!c){div.innerHTML='<button class="btn" onclick="document.getElementById(\\'authPanel\\').style.display=\\'grid\\'">Kirish / Ro\\'yxatdan o\\'tish</button>';return}
    const rec=u[c];
    const initials=initialsFrom(rec.fullname);
    const color=rec.avatarColor||pastelFromSeed(c);
    div.innerHTML=`<div class="row"><span class="avatar" style="background:${color}">${initials}</span><div><b>${rec.fullname}</b><br><span class="hint">@${rec.username}</span></div></div><div class="row" style="margin-top:12px"><button class='btn' id='editOpen'>Profilni tahrirlash</button><button class='btn ghost' onclick='clearCur();render()'>Chiqish</button></div>`;
    document.getElementById('editOpen').onclick=()=>{
      document.getElementById('edit_fullname').value=rec.fullname;
      document.getElementById('edit_username').value=rec.username;
      document.getElementById('edit_password').value='';
      const ea=document.getElementById('editAvatar');
      ea.textContent=initials;ea.style.background=color;
      document.getElementById('editPanel').style.display='grid';
    }
  }
  render();
</script>
</body>
</html>
